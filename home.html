<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task28 Elite - Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --gold: #FFD700; --dark: #050505; --card: #141414; }
        body { background: var(--dark); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 80px; }
        
        /* Navbar */
        .nav { display: flex; justify-content: space-between; padding: 15px 20px; background: rgba(20,20,20,0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .brand { font-size: 1.2rem; font-weight: 800; color: var(--gold); letter-spacing: 1px; }
        .p-icon { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--gold); background-size: cover; cursor: pointer; }
        .locked-profile { filter: grayscale(1); opacity: 0.5; pointer-events: none; }

        /* User Info */
        .hero { text-align: center; padding: 20px; }
        .u-name { font-size: 1.5rem; font-weight: bold; }
        .badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; margin-top: 5px; font-weight: bold; }
        .b-active { background: linear-gradient(90deg, #11998e, #38ef7d); box-shadow: 0 0 10px #11998e; }
        .b-inactive { background: #333; color: #aaa; border: 1px solid #555; }

        /* Stats */
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 15px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #222; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .card h2 { margin: 5px 0; color: var(--gold); font-size: 1.4rem; }
        .card p { margin: 0; font-size: 0.75rem; color: #888; text-transform: uppercase; }

        /* Banner */
        .banner { width: 92%; height: 140px; margin: 20px auto; border-radius: 10px; overflow: hidden; border: 1px solid #333; position: relative; }
        .slide { width: 100%; height: 100%; object-fit: cover; display: none; animation: fade 1s; }
        .active-slide { display: block; }
        @keyframes fade { from {opacity: 0.5} to {opacity: 1} }

        /* Menu */
        .menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 0 15px; }
        .m-item { background: var(--card); padding: 15px 5px; border-radius: 10px; text-align: center; border: 1px solid #222; color: #fff; text-decoration: none; position: relative; transition: 0.3s; }
        .m-item:active { transform: scale(0.95); }
        .m-item i { font-size: 1.5rem; margin-bottom: 8px; color: var(--gold); }
        .m-item span { font-size: 0.8rem; display: block; }

        /* Lock System */
        .locked { opacity: 0.4; pointer-events: none; filter: grayscale(100%); }
        .lock-icon { position: absolute; top: 5px; right: 5px; color: #ff4444; font-size: 12px; }

        /* Admin Msg */
        #notify { background: rgba(255, 215, 0, 0.15); border-left: 4px solid var(--gold); padding: 10px; margin: 15px; border-radius: 5px; display: none; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="nav">
    <div class="brand">TASK28 ELITE</div>
    <div style="display:flex; gap:15px; align-items:center;">
        <i class="fas fa-language" onclick="toggleLang()" style="font-size:1.5rem; color:var(--gold);"></i>
        <a href="profile.html" id="p-link" class="locked-profile">
            <div class="p-icon" id="p-img" style="background-image: url('https://cdn-icons-png.flaticon.com/512/149/149071.png');"></div>
        </a>
    </div>
</div>

<div id="notify"></div>

<div class="hero">
    <div style="font-size: 0.9rem; color: #888;">Welcome Back,</div>
    <div class="u-name" id="u_name">Loading...</div>
    <div class="badge b-inactive" id="status-badge">Inactive (Pending)</div>
    <div style="margin-top:5px; font-size:0.8rem; color:var(--gold);">Tasks: <span id="t-count">0</span>/2</div>
</div>

<div class="stats">
    <div class="card"><h2>৳ <span id="bal">0</span></h2><p id="l_bal">Balance</p></div>
    <div class="card"><h2>৳ <span id="lbal">0</span></h2><p id="l_life">Lifetime</p></div>
    <div class="card"><h2 id="tref">0</h2><p id="l_ref">Total Ref</p></div>
    <div class="card"><h2 id="dref">0</h2><p id="l_dref">Today Ref</p></div>
</div>

<div class="banner">
    <img src="https://via.placeholder.com/600x200/000000/ffd700?text=Premium+Access" class="slide active-slide">
    <img src="https://via.placeholder.com/600x200/111111/ffd700?text=Elite+Earnings" class="slide">
    <img src="https://via.placeholder.com/600x200/222222/ffd700?text=Refer+Now" class="slide">
</div>

<div class="menu">
    <a href="task.html" class="m-item"><i class="fas fa-fingerprint"></i><span id="b_task">Start Task</span></a>
    
    <a href="withdraw.html" class="m-item locked" id="btn-wd">
        <i class="fas fa-wallet"></i><i class="fas fa-lock lock-icon"></i><span id="b_with">Withdraw</span>
    </a>
    
    <a href="monthly_weekly.html" class="m-item locked" id="btn-pl">
        <i class="fas fa-calendar-check"></i><i class="fas fa-lock lock-icon"></i><span id="b_plan">Plans</span>
    </a>
    
    <a href="referral.html" class="m-item locked" id="btn-ref">
        <i class="fas fa-users"></i><i class="fas fa-lock lock-icon"></i><span id="b_ref">Referral</span>
    </a>
    
    <a href="history.html" class="m-item locked" id="btn-his">
        <i class="fas fa-history"></i><i class="fas fa-lock lock-icon"></i><span id="b_hist">History</span>
    </a>

    <div class="m-item" onclick="firebase.auth().signOut()"><i class="fas fa-sign-out-alt" style="color:#ff4444;"></i><span>Logout</span></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCXMFqxIe8IrZkzUx2YVMTvVXQmIAhtruc",
        authDomain: "love-1-6cdb1.firebaseapp.com",
        databaseURL: "https://love-1-6cdb1-default-rtdb.firebaseio.com",
        projectId: "love-1-6cdb1",
        storageBucket: "love-1-6cdb1.firebasestorage.app",
        messagingSenderId: "949848083048",
        appId: "1:949848083048:web:ced52526264da1dcf4c9dd"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let lang = 'en';
    const dict = {
        en: { act: "Active - You", inact: "Inactive (Pending)", bal: "Current Balance", life: "Lifetime Income", tr: "Total Ref", dr: "Today Ref", bt: "Start Task", bw: "Withdraw", bp: "Plans", br: "Referral", bh: "History" },
        bn: { act: "অ্যাকাউন্ট সক্রিয়", inact: "অ্যাকাউন্ট পেন্ডিং", bal: "বর্তমান ব্যালেন্স", life: "মোট আয়", tr: "মোট রেফার", dr: "আজকের রেফার", bt: "কাজ শুরু", bw: "উত্তোলন", bp: "প্ল্যানসমূহ", br: "রেফারেল", bh: "ইতিহাস" }
    };

    auth.onAuthStateChanged(user => {
        if(!user) return window.location.href = "register_login.html";
        
        db.ref('users/' + user.uid).on('value', snap => {
            const d = snap.val();
            if(!d) return;

            // Data Fill (Using Optional Chaining ?. to prevent errors)
            document.getElementById('u_name').innerText = d.firstName || "User";
            document.getElementById('bal').innerText = d.balance || 0;
            document.getElementById('lbal').innerText = d.lifetimeBalance || 0;
            document.getElementById('tref').innerText = d.totalReferrals || 0;
            document.getElementById('dref').innerText = d.todayReferrals || 0;
            document.getElementById('t-count').innerText = d.tasksCompleted || 0;
            
            if(d.profileImage) document.getElementById('p-img').style.backgroundImage = `url('${d.profileImage}')`;

            // Active Logic
            const active = (d.tasksCompleted >= 2);
            const badge = document.getElementById('status-badge');
            
            if(active) {
                badge.className = "badge b-active";
                badge.innerText = (lang === 'en') ? dict.en.act : dict.bn.act;
                
                // Unlock Buttons
                ['btn-wd', 'btn-pl', 'btn-ref', 'btn-his'].forEach(id => {
                    document.getElementById(id).classList.remove('locked');
                    document.getElementById(id).querySelector('.lock-icon').style.display = 'none';
                });
                document.getElementById('p-link').classList.remove('locked-profile');
            } else {
                badge.className = "badge b-inactive";
                badge.innerText = (lang === 'en') ? dict.en.inact : dict.bn.inact;
            }
            updateLang();
        });

        // Admin Message Listener
        db.ref('admin_messages').limitToLast(1).on('value', s => {
            const data = s.val();
            if(data) {
                const msg = Object.values(data)[0].text;
                const n = document.getElementById('notify');
                n.style.display = 'block'; n.innerHTML = `<i class="fas fa-bell"></i> Admin: ${msg}`;
                setTimeout(() => n.style.display = 'none', 12000);
            }
        });
    });

    function toggleLang() {
        lang = (lang === 'en') ? 'bn' : 'en';
        updateLang();
    }

    function updateLang() {
        const t = dict[lang];
        document.getElementById('l_bal').innerText = t.bal;
        document.getElementById('l_life').innerText = t.life;
        document.getElementById('l_ref').innerText = t.tr;
        document.getElementById('l_dref').innerText = t.dr;
        document.getElementById('b_task').innerText = t.bt;
        document.getElementById('b_with').innerText = t.bw;
        document.getElementById('b_plan').innerText = t.bp;
        document.getElementById('b_ref').innerText = t.br;
        document.getElementById('b_hist').innerText = t.bh;
    }

    // Banner Slider
    let idx = 0;
    const slides = document.querySelectorAll('.slide');
    function cycle() {
        slides.forEach(s => s.classList.remove('active-slide'));
        idx = (idx + 1) % slides.length;
        slides[idx].classList.add('active-slide');
    }
    setInterval(cycle, 4000);
</script>
</body>
</html>
