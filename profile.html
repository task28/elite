<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task28 Elite - My Profile</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-gold: #FFD700;
            --dark-bg: #0a0a0a;
            --card-bg: #161616;
            --text-light: #e0e0e0;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .profile-container {
            width: 90%;
            max-width: 400px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
            border: 1px solid #333;
            position: relative;
        }

        .page-title {
            color: var(--primary-gold);
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }

        /* Profile Image Area */
        .image-wrapper {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px auto;
        }

        .profile-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary-gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            background-image: url('https://cdn-icons-png.flaticon.com/512/149/149071.png');
            background-size: cover;
            background-position: center;
        }

        /* Upload Button (Camera Icon) */
        .upload-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--primary-gold);
            color: black;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            transition: 0.3s;
        }

        .upload-btn:hover {
            transform: scale(1.1);
            background: white;
        }

        #fileInput {
            display: none;
        }

        /* Info Text */
        .user-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-top: 10px;
        }
        .user-phone {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        /* Back Button */
        .back-btn {
            background: transparent;
            border: 1px solid var(--primary-gold);
            color: var(--primary-gold);
            padding: 10px 30px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            margin-top: 20px;
            transition: 0.3s;
        }
        .back-btn:hover {
            background: var(--primary-gold);
            color: black;
        }

        .status-msg {
            font-size: 0.8rem;
            margin-top: 10px;
            height: 20px;
        }
    </style>
</head>
<body>

    <div class="profile-container">
        <div class="page-title">MY PROFILE</div>

        <!-- Image Display -->
        <div class="image-wrapper">
            <!-- Image tag empty initially, bg image set in CSS -->
            <img id="display-img" class="profile-img" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
            
            <!-- Camera Button -->
            <label for="fileInput" class="upload-btn">
                <i class="fas fa-camera"></i>
            </label>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="user-name" id="p_name">Loading...</div>
        <div class="user-phone" id="p_phone">...</div>

        <div class="status-msg" id="msg" style="color: #ffd700;"></div>

        <button class="back-btn" onclick="window.location.href='home.html'">
            <i class="fas fa-arrow-left"></i> Back to Home
        </button>
    </div>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyCXMFqxIe8IrZkzUx2YVMTvVXQmIAhtruc",
            authDomain: "love-1-6cdb1.firebaseapp.com",
            databaseURL: "https://love-1-6cdb1-default-rtdb.firebaseio.com",
            projectId: "love-1-6cdb1",
            storageBucket: "love-1-6cdb1.firebasestorage.app",
            messagingSenderId: "949848083048",
            appId: "1:949848083048:web:ced52526264da1dcf4c9dd"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let uid = null;

        // --- AUTH CHECK ---
        auth.onAuthStateChanged((user) => {
            if (user) {
                uid = user.uid;
                loadProfile();
            } else {
                window.location.href = "index.html";
            }
        });

        // --- LOAD DATA ---
        function loadProfile() {
            db.ref('users/' + uid).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('p_name').innerText = data.firstName + " " + data.lastName;
                    document.getElementById('p_phone').innerText = data.phone;
                    
                    // If image exists in DB, show it
                    if (data.profileImage) {
                        document.getElementById('display-img').src = data.profileImage;
                    }
                }
            });
        }

        // --- UPLOAD IMAGE LOGIC (Base64) ---
        // আমরা ইমেজকে টেক্সট ফরম্যাটে (Base64) কনভার্ট করে ডাটাবেসে সেভ করব
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const msg = document.getElementById('msg');

            if (file) {
                // Check File Size (Max 2MB limit recommended for Realtime DB)
                if (file.size > 2 * 1024 * 1024) {
                    msg.innerText = "Error: Image size too big! Use < 2MB";
                    msg.style.color = "red";
                    return;
                }

                msg.innerText = "Uploading...";
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64String = e.target.result;

                    // Update Database
                    db.ref('users/' + uid).update({
                        profileImage: base64String
                    }).then(() => {
                        msg.innerText = "Profile Updated Successfully!";
                        msg.style.color = "#00ff00";
                        setTimeout(() => { msg.innerText = ""; }, 3000);
                    }).catch((error) => {
                        msg.innerText = "Error uploading!";
                        console.error(error);
                    });
                };
                reader.readAsDataURL(file);
            }
        });

    </script>

</body>
</html>
