<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0a0a0a; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .p-card { width: 85%; max-width: 350px; background: #141414; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid #333; box-shadow: 0 0 20px rgba(255, 215, 0, 0.1); }
        .img-box { width: 120px; height: 120px; margin: 0 auto; position: relative; }
        .p-img { width: 100%; height: 100%; border-radius: 50%; border: 3px solid #ffd700; object-fit: cover; }
        .cam-btn { position: absolute; bottom: 0; right: 0; background: #ffd700; color: #000; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .name { font-size: 1.5rem; font-weight: bold; margin-top: 15px; color: #ffd700; }
        .phone { color: #888; font-size: 0.9rem; margin-bottom: 20px; }
        .back-btn { background: transparent; border: 1px solid #ffd700; color: #ffd700; padding: 10px 25px; border-radius: 20px; cursor: pointer; margin-top: 15px; }
        .back-btn:hover { background: #ffd700; color: #000; }
    </style>
</head>
<body>
    <div class="p-card">
        <div class="img-box">
            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="p-img" id="display">
            <label for="f-in" class="cam-btn"><i class="fas fa-camera"></i></label>
            <input type="file" id="f-in" hidden accept="image/*">
        </div>
        <div class="name" id="p-name">Loading...</div>
        <div class="phone" id="p-phone">...</div>
        <div id="stat" style="font-size:0.8rem; height:20px;"></div>
        <button class="back-btn" onclick="window.location.href='home.html'"><i class="fas fa-arrow-left"></i> Home</button>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyCXMFqxIe8IrZkzUx2YVMTvVXQmIAhtruc", authDomain: "love-1-6cdb1.firebaseapp.com", databaseURL: "https://love-1-6cdb1-default-rtdb.firebaseio.com", projectId: "love-1-6cdb1", storageBucket: "love-1-6cdb1.firebasestorage.app", messagingSenderId: "949848083048", appId: "1:949848083048:web:ced52526264da1dcf4c9dd" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        auth.onAuthStateChanged(u => {
            if(u) {
                db.ref('users/'+u.uid).on('value', s => {
                    const d = s.val();
                    if(d) {
                        document.getElementById('p-name').innerText = d.firstName + " " + d.lastName;
                        document.getElementById('p-phone').innerText = d.phone;
                        if(d.profileImage) document.getElementById('display').src = d.profileImage;
                    }
                });
                
                document.getElementById('f-in').addEventListener('change', e => {
                    const f = e.target.files[0];
                    if(f && f.size < 2000000) { // < 2MB
                        document.getElementById('stat').innerText = "Uploading...";
                        const r = new FileReader();
                        r.onload = ev => {
                            db.ref('users/'+u.uid).update({ profileImage: ev.target.result })
                              .then(() => document.getElementById('stat').innerText = "Updated!");
                        };
                        r.readAsDataURL(f);
                    } else {
                        document.getElementById('stat').innerText = "File too big (Max 2MB)";
                        document.getElementById('stat').style.color = "red";
                    }
                });
            } else window.location.href = "index.html";
        });
    </script>
</body>
</html>
